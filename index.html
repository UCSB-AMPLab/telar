---
layout: default
title: Home
---

<div class="container my-5">
  <div class="row">
    <div class="col-lg-11 mx-auto">
      {% assign logo_path = site.telar.logo | strip %}
      {% if logo_path != "" %}
      <img src="{{ logo_path | relative_url }}" alt="{{ site.title }}" class="mb-4" style="max-width: 200px;">
      {% endif %}

      <h1 class="display-4 mb-3">{{ site.telar.project_title | default: site.title }}</h1>

      {% if site.telar.tagline %}
      <p class="lead mb-5">{{ site.telar.tagline }}</p>
      {% endif %}
    </div>
  </div>

  {% if site.description %}
  <div class="row">
    <div class="col-lg-11 mx-auto">
      <p class="lead mb-5">{{ site.description }}</p>
    </div>
  </div>
  {% endif %}

  <!-- Stories List -->
  <div class="row">
    <div class="col-lg-11 mx-auto">
      <h2 class="mb-4">Explore the stories</h2>

      {% if site.stories.size > 0 %}
      <div class="row row-cols-1 row-cols-md-2 row-cols-lg-4 g-5">
        {% for story in site.stories %}
        <div class="col">
          <a href="{{ story.url | relative_url }}" class="story-card text-decoration-none">
            <div class="card h-100 border-0 shadow-sm">
              {%- comment -%}Load story data file and extract first object{%- endcomment -%}
              {% assign story_data = site.data[story.data_file] %}
              {% if story_data and story_data.size > 0 %}
                {% assign first_step = story_data[0] %}
                {% if first_step.object %}
                  {%- comment -%}Load thumbnail via info.json (same as objects gallery){%- endcomment -%}
                  <div class="local-iiif-thumbnail card-img-top" data-info-json="{{ '/iiif/objects/' | append: first_step.object | append: '/info.json' | relative_url }}" style="aspect-ratio: 1; overflow: hidden;">
                    <div class="manifest-thumbnail-placeholder bg-light d-flex align-items-center justify-content-center h-100">
                      <span class="text-muted">Loading...</span>
                    </div>
                  </div>
                {% else %}
                  {%- comment -%}Fallback placeholder if no object{%- endcomment -%}
                  <div class="story-thumbnail-placeholder bg-secondary d-flex align-items-center justify-content-center" style="aspect-ratio: 1;">
                    <span class="text-white">{{ story.story_number }}</span>
                  </div>
                {% endif %}
              {% else %}
                {%- comment -%}Fallback placeholder if no data file{%- endcomment -%}
                <div class="story-thumbnail-placeholder bg-secondary d-flex align-items-center justify-content-center" style="aspect-ratio: 1;">
                  <span class="text-white">{{ story.story_number }}</span>
                </div>
              {% endif %}

              <div class="card-body">
                <h3>{{ story.title }}</h3>
              </div>
            </div>
          </a>
        </div>
        {% endfor %}
      </div>
      {% else %}
      <div class="alert alert-info">
        <p class="mb-0">No stories available yet. Create story files in the <code>_stories/</code> directory to get started.</p>
      </div>
      {% endif %}
    </div>
  </div>

  <!-- Objects Teaser -->
  {% if site.objects.size > 0 %}
  <div class="row mt-5">
    <div class="col-lg-11 mx-auto">
      <h3 class="mb-4">See the objects behind the stories</h3>
      <p class="lead">Browse {{ site.objects.size }} objects featured in the stories.</p>
      <a href="{{ '/objects/' | relative_url }}" class="btn panel-trigger">View Objects</a>
    </div>
  </div>
  {% endif %}
</div>

<script>
/**
 * Load story thumbnails from IIIF info.json
 */
document.addEventListener('DOMContentLoaded', function() {
  const storyThumbnails = document.querySelectorAll('.local-iiif-thumbnail[data-info-json]');

  storyThumbnails.forEach(function(item) {
    const infoUrl = item.getAttribute('data-info-json');

    fetch(infoUrl)
      .then(response => response.json())
      .then(info => {
        // Get the largest available size from sizes array
        const sizes = info.sizes || [];
        let thumbnailSize = sizes[0]; // First element is largest

        if (thumbnailSize) {
          const baseUrl = info.id || info['@id'];
          // Use base URL directly - it already points to the image service
          const thumbnailUrl = `${baseUrl}/full/${thumbnailSize.width},/0/default.jpg`;

          const img = document.createElement('img');
          img.src = thumbnailUrl;
          img.alt = item.closest('.story-card').querySelector('h3').textContent;
          img.style.width = '100%';
          img.style.height = '100%';
          img.style.objectFit = 'cover';

          const placeholder = item.querySelector('.manifest-thumbnail-placeholder');
          if (placeholder) {
            placeholder.replaceWith(img);
          }
        }
      })
      .catch(error => {
        console.error('Error loading IIIF info.json:', infoUrl, error);
        const placeholder = item.querySelector('.manifest-thumbnail-placeholder');
        if (placeholder) {
          placeholder.innerHTML = '<span class="text-danger">Failed to load</span>';
        }
      });
  });
});
</script>
