name: Test Telar JavaScript
#
# The JavaScript that drives Telar's story page is split into separate source
# files in assets/js/telar-story/, each responsible for one concern: state
# management, viewer cards, panels, navigation, and shared utilities. These
# files use ES modules (the standard JavaScript import/export system) so that
# each file can declare what it needs from the others. At build time, esbuild
# bundles them into a single file for the browser.
#
# This workflow runs the Vitest unit test suite for those source files on
# every push and pull request to main. The tests live in tests/js/ and cover
# the pure logic functions: coordinate maths, manifest URL resolution, content
# detection predicates, and state structure verification.
#
# Two of the functions under test (fixImageUrls and getBasePath) interact with
# browser APIs like document.createElement and window.location. Rather than
# launching a real browser, the tests use jsdom â€” a pure-JavaScript
# implementation of these browser APIs that runs in Node.js. This keeps the
# test suite fast and free of external dependencies: no browser binary,
# network access, or Jekyll server is needed.
#
# Version: v0.7.0-beta

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Install dependencies
        run: npm install

      - name: Run JavaScript unit tests
        run: npm run test:js
